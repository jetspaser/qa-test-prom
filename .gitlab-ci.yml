stages:
  - test

run_playwright_tests:
  stage: test
  # Используем официальный образ Playwright с предустановленным Python
  image: mcr.microsoft.com/playwright/python:v1.40.0-jammy

  variables:
    # Отключаем создание .pyc файлов, чтобы не мусорить в контейнере
    PYTHONDONTWRITEBYTECODE: 1
    # Включаем логирование в реальном времени
    PYTHONUNBUFFERED: 1

  before_script:
    - python -V
    - pip install --upgrade pip
    - pip install -r requirements.txt
    # Устанавливаем браузеры (если они не зашиты в образ или нужны другие)
    - playwright install chromium --with-deps

  script:
    # Запускаем pytest. Флаг --base-url можно передать здесь, если он не в pytest.ini
    - pytest --junitxml=report.xml

  artifacts:
    when: always
    paths:
      - test-results/       # Скриншоты и видео при падениях
      - report.xml          # JUnit отчет для интеграции с GitLab
    reports:
      junit: report.xml     # GitLab покажет результаты тестов прямо в Merge Request
    expire_in: 1 week